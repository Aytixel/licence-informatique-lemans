const izly_element=document.getElementById("izly"),izly_form_element=document.getElementById("izly-connection-form"),izly_email_element=document.getElementById("izly-email"),izly_qrcode_element=document.getElementById("izly-qrcode"),izly_balance_element=document.getElementById("izly-balance"),izly_switch_account_button_element=document.getElementById("izly-change-account"),encrypt=(e,t)=>{const l=[...e.toString()].reduce(((e,t)=>({x:e.x+(!+t&&!e.c),c:e.c+ +t})),{x:0,c:0}).x,n=8+Math.round(28*Math.random());return n+(+e+t.length).toString(n)+n.toString().length+l},update_izly=async()=>{const e=JSON.parse(localStorage.getItem("izly"));if(e){izly_email_element.textContent=e.email;try{const t=await(await fetch("https://api.licence-informatique-lemans.tk/v2/izly-qrcode.json",{method:"post",body:JSON.stringify(e)})).json();localStorage.setItem("izly-qrcode",t[0].Src),localStorage.setItem("izly-balance",t[1]),izly_qrcode_element.src=t[0].Src,izly_balance_element.textContent=`Solde : ${t[1].toString().replace(".",",")} €`}catch{izly_qrcode_element.src=localStorage.getItem("izly-qrcode")||"",izly_balance_element.textContent=`Solde : ${localStorage.getItem("izly-balance")?.toString().replace(".",",")||""} €`}izly_element.classList.add("connected")}else izly_element.classList.remove("connected")};update_izly(),izly_switch_account_button_element.addEventListener("click",(()=>{localStorage.removeItem("izly"),update_izly()})),document.getElementById("menu-button").addEventListener("pointerup",(()=>{izly_element.children[0].open=izly_element.classList.contains("connected")})),izly_form_element.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(izly_form_element),l={email:t.get("email"),code:encrypt(t.get("code"),t.get("email"))};izly_form_element.children[0].value="",izly_form_element.children[1].value="",localStorage.setItem("izly",JSON.stringify(l)),update_izly()}));
